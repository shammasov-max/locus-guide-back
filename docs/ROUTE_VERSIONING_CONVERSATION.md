Stanislav Svarichevsky, [12/25/2025 7:54 AM]
json маршрута зачем нам разбирать? Мы его записываем как есть, по нему ни поиска ничего не будет.

Max Shammasov, [12/25/2025 8:01 AM]
ну над этим пришлось поработать, не получится так по цифоркам ходить. разъедутся. Новая версия маршрута — все новые точки, объясню

Max Shammasov, [12/25/2025 8:07 AM]
юзер, на маршруте, на определённой его версии, попадает на чекпоин - на каждый такой момент иденпотентный вызов. Зачекинился

Max Shammasov, [12/25/2025 8:08 AM]
обсудим стори - если просто с двух девайсов зашёл, может ты увидел проще запись — пока думал над аппом

Stanislav Svarichevsky, [12/25/2025 8:08 AM]
у пользователя может быть только одна версия - которую он начал проходить, он не может выбирать версии

Stanislav Svarichevsky, [12/25/2025 8:09 AM]
редактор - работает только над актуальной версией.

Stanislav Svarichevsky, [12/25/2025 8:11 AM]
редактор/админ видит список версий и могут в любую зайти. Править предыдущие версии не имеет смысла, правим актуальную и она при этом не меняет версионирование, данные перезатираются

Max Shammasov, [12/25/2025 8:11 AM]
не нужно редактору знать все предыдущие версии, у него другой роут - не 1 в 1 крудятину звать

Max Shammasov, [12/25/2025 8:11 AM]
всмысле знать ему не нужно - что я её так разрезал

Max Shammasov, [12/25/2025 8:13 AM]
по разобранным чекпоинтам  прогресс считать и ачивы

Stanislav Svarichevsky, [12/25/2025 8:13 AM]
версионирование нужно, только года происходит добавление или убирание точек, при изменение реальной обстановки на маршруте.  Это редко происходит. Пока маршрут не запаблищен, пользователи его не видят (кроме тестеров)

Max Shammasov, [12/25/2025 8:13 AM]
версия маршрута появляется только при публикации, при создании маршрута нового - у него нет версии, и только джейсон внутри маршрута

Stanislav Svarichevsky, [12/25/2025 8:14 AM]
прогресс считается на клиенте. Потому что при работе маршрута в офлайн режиме невозможно связываться с базой

Stanislav Svarichevsky, [12/25/2025 8:14 AM]
а если редактируется публикованный маршрут?

Max Shammasov, [12/25/2025 8:15 AM]
пользователь может два раза прогресс отправить

Stanislav Svarichevsky, [12/25/2025 8:15 AM]
например ошибка в названии

Max Shammasov, [12/25/2025 8:16 AM]
нет, он иммутабельный становится, после публикации лучше не редактировать - иначе ещё навороты

Max Shammasov, [12/25/2025 8:16 AM]
окей, мне важно что бы не удалялись и не добавлялись точки

Max Shammasov, [12/25/2025 8:16 AM]
ну короче ид и факт того, что они не меняются местами

Stanislav Svarichevsky, [12/25/2025 8:16 AM]
Основная идея версий - это редактирование опубликованного маршрута. Пока он не опубликован - нет и версий

Max Shammasov, [12/25/2025 8:17 AM]
я про то, что после публикации - про версию

Stanislav Svarichevsky, [12/25/2025 8:17 AM]
то есть версии создаются, если добавлены или удалены точки? (в опубликованном маршруте)

Max Shammasov, [12/25/2025 8:17 AM]
да

Max Shammasov, [12/25/2025 8:17 AM]
но если нажали опубликовать

Max Shammasov, [12/25/2025 8:18 AM]
короче - после публикации сразу версия создаётся

Stanislav Svarichevsky, [12/25/2025 8:18 AM]
так если он уже опубликован? Я только сейчас про них говорю

Max Shammasov, [12/25/2025 8:18 AM]
и она уже идёт в работу, вот там менять порядок точек нельзя

Stanislav Svarichevsky, [12/25/2025 8:19 AM]
наверно об этом нужно договориться. Ты как в конфлюенсе думаешь, любая правка опубликованного маршрута создает новую неопубликованную версию?

Max Shammasov, [12/25/2025 8:21 AM]
когда редачишь документ - это его текущее состояние, а опубликованный документ - это другой объект другая сущность. и поведение у неё другое и поля, например время когда опубликовали , или неизменяемые части

Max Shammasov, [12/25/2025 8:21 AM]
нажал опубликовать - создалась версия-копия, но она под другим правилам живёт

Max Shammasov, [12/25/2025 8:22 AM]
да, можно в версии маршрута и точки сменить мета данные, а вот ид — не стоит, это поломает прогрессы

Stanislav Svarichevsky, [12/25/2025 8:22 AM]
на самом деле - нужно не так. Только добавление и удаление точек опубликованного маршрута ведет к новой неопубликованной версии (копии). Если мы правим название точки, json переписывается в это же место, нам не нужно создавать новую версию

Max Shammasov, [12/25/2025 8:23 AM]
Ну это такая стори, не очевидная. Пусть в историю заходит

Max Shammasov, [12/25/2025 8:24 AM]
Или ты предлагаешь после публикации  проверять, а менял ли он точки и как менял

Max Shammasov, [12/25/2025 8:25 AM]
Пусть заходит в предыдущий и добавит текст. Иначе странный момент, публикация приводит к двум исходам либо новая версия , либо апдейт

Stanislav Svarichevsky, [12/25/2025 8:25 AM]
У нас правило - если пользователь начал проходить маршрут - у него уже версия не меняется, иначе собъется прогрес (количество точек если например уменьшиться). Но если изменилось название точки, то это ни на что не влияет и мы можем ее изменить (опечатку) из-за одного символа нет смысла хранить целиком новый json

Max Shammasov, [12/25/2025 8:26 AM]
Удалил, установил приложение, телефон поменял. С девушкой идёт, один акк на двух телах слушает один маршрут или группа друзей

Max Shammasov, [12/25/2025 8:27 AM]
За прогрессом следить как, обрисуем пару стори - подумаем

Stanislav Svarichevsky, [12/25/2025 8:28 AM]
я вверху объяснил причину, нет смысла создавать копию из-за опечатки в одной букве. Этого будет много

Stanislav Svarichevsky, [12/25/2025 8:28 AM]
но обязательно если есть новые или удаленные точки.

Max Shammasov, [12/25/2025 8:30 AM]
Я понял, в версии опубликованной можно менять что угодно задним числом кроме порядка. Окей, в админке сделаем проверку если меня точки , то варнинг, вы уверены ? Как-то так

Max Shammasov, [12/25/2025 8:31 AM]
По порядку пройдём, вместе , посмотрим

Stanislav Svarichevsky, [12/25/2025 8:36 AM]
Еще вопрос. У нас в маршруте (в json) 2 языка. Маршрут опубликовали и по нему ходят. Через какое-то время мы решили добавить в этот маршрут испанский язык и планомерно добавляем не изменяя маршрут mp3 в каталог и делаем правки в описаниях объектов.

По идее мы в маршрут карточки не добавляем язык, пока не уверены в том, что всё завершено. Как только мы добавили в язык карточку, то у пользователей появляется возможность его проходить на этом языке. Получается он всё время был опубликован, но доступа нет к языку, потому что нет отметки об этом языке. Вот нам получается в карточке должна быть возможность менять язык. Возможно в админке нужно в списке маршрутов этого языка проставлять язык

Max Shammasov, [12/25/2025 8:42 AM]
Хорошая стори, надо подумать, точка на маршруте и информационный бандл - независимые.

Max Shammasov, [12/25/2025 8:46 AM]
Я как пользователь приехал к маме в Питер, прошел пол маршрута, уехал. Через неделю вернулся, и... ? Решил продолжить маршрут. Хотя не, менеджеры поступательно добавляют тексты на точки, и языки в процессе набора не видны юзеру

Stanislav Svarichevsky, [12/25/2025 8:48 AM]
он продолжает проходить ту версию маршрута, которую начал (если точки добавились - он этого не видит)

Stanislav Svarichevsky, [12/25/2025 8:49 AM]
Начет языков - сложней.... язык добавлялся в последнюю версию

Max Shammasov, [12/25/2025 8:49 AM]
Все понял, ты в копии старые не добавляешь языки. Ну и норм. У менеджера всегда временная копия

Max Shammasov, [12/25/2025 8:51 AM]
Но текст к уже опубликованному можно обновиться, плохо. Надо что бы менеджер переиспользовал точки и автоинкремент новых продолжал старые копии, тогда можно обновить чекпоинты по всем предыдущим версиям

Stanislav Svarichevsky, [12/25/2025 8:53 AM]
Текст - то только название точек. А аудио изменения к той же точке наоборот норм

Max Shammasov, [12/25/2025 8:54 AM]
Даже если менеджер удалил из середины маршрута точку, надо автоинкремент

Stanislav Svarichevsky, [12/25/2025 8:54 AM]
Да. Это новая версия

Stanislav Svarichevsky, [12/25/2025 8:54 AM]
Причем новая неопубликованная

Max Shammasov, [12/25/2025 8:55 AM]


Stanislav Svarichevsky, [12/25/2025 8:56 AM]
Этот автоинкремент уже сделан сейчас. нумерация меняется (как последовательности, так и видимости) - но id точек не меняется

Max Shammasov, [12/25/2025 8:57 AM]
есть ли там ласт ид, что бы с конца не удалить и не добавить заново?

Stanislav Svarichevsky, [12/25/2025 8:58 AM]
Display number и Route index пересчитываются, но аудио привязано к id (может там number называется?)

Stanislav Svarichevsky, [12/25/2025 8:59 AM]
неважно откуда добавляешь и что удаляешь. С пересчетом последовательности всё ок. Там при добавлении нужно указать предыдущую точку. При этом id 161 можно сделать второй укзазав предыдущей точкой первую, точка останеться id 161

Max Shammasov, [12/25/2025 9:14 AM]
А можно  хэш uuid выставлять всем точкамис фронта, мне не нужно парсить Джейсон, и пропадают вот эти 4 number, display, route_id. Мне только список нужен

Max Shammasov, [12/25/2025 9:16 AM]
Выдав юид, оба знают к чему i18n привязана, и чекпоинт имеет юид

Max Shammasov, [12/25/2025 9:17 AM]
Сорри, к обеду буду дома только. Пока пишите

Stanislav Svarichevsky, [12/25/2025 10:37 AM]
чтобы получить список - всю равно парсить json